\
{% extends 'base.html' %}
{% block content %}
<div class="card bg-base-200">
  <div class="card-body">
    <h2 class="card-title">All Expenses</h2>
    <form class="grid grid-cols-2 md:grid-cols-7 gap-2 items-end">
      <label class="form-control">
        <span class="label-text">Start</span>
        <input type="date" name="start" value="{{ start or '' }}" class="input input-bordered" />
      </label>
      <label class="form-control">
        <span class="label-text">End</span>
        <input type="date" name="end" value="{{ end or '' }}" class="input input-bordered" />
      </label>
      <label class="form-control">
        <span class="label-text">Category</span>
        <select name="category" class="select select-bordered">
          <option value="">All</option>
          {% for c in cats %}
            <option value="{{ c }}" {% if category==c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="form-control">
        <span class="label-text">Payment Type</span>
        <select name="payment_type" class="select select-bordered">
          <option value="">Any</option>
          {% for pt in ['Advance','Final','Other'] %}
            <option value="{{ pt }}" {% if payment_type==pt %}selected{% endif %}>{{ pt }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="form-control col-span-2">
        <span class="label-text">Search (vendor/description/notes)</span>
        <input type="text" name="search" value="{{ search or '' }}" class="input input-bordered" placeholder="e.g. caterer, DJ, advance" />
      </label>
      <button class="btn btn-primary">Filter</button>
    </form>

    <div class="mt-4 font-medium">Subtotal (filtered): ₹{{ '%.2f'|format(subtotal) }}</div>

    <div class="overflow-x-auto mt-2">
      <table class="table">
        <thead>
          <tr>
            <th>Date & Time</th>
            <th>Category</th>
            <th>Sub</th>
            <th>Vendor</th>
            <th>Description</th>
            <th>Mode</th>
            <th>Type</th>
            <th class="text-right">Amount</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for e in expenses %}
          <tr>
            <td>{{ e.dt|ist }}</td>
            <td>{{ e.category }}</td>
            <td>{{ e.subcategory or '-' }}</td>
            <td>{{ e.vendor or '-' }}</td>
            <td>{{ e.description or '-' }}</td>
            <td>{{ e.payment_mode or '-' }}</td>
            <td>{{ e.payment_type or '-' }}</td>
            <td class="text-right">₹{{ '%.2f'|format(e.amount) }}</td>
            <td class="text-right">
              <a class="btn btn-xs" href="{{ url_for('expense_form', expense_id=e.id) }}">Edit</a>
              <form action="{{ url_for('expense_delete', expense_id=e.id) }}" method="post" class="inline">
                <button class="btn btn-xs btn-error" onclick="return confirm('Delete this entry?')">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
